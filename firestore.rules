
rules_version = '2';

// Helper function to check if a user is an admin
function isAdmin() {
  // The admin UIDs are stored in a document in a private collection.
  // This is more secure than hardcoding them in the rules.
  // Note: We will need to create this document in Firestore.
  // For now, let's use a hardcoded list for simplicity and to get you unblocked.
  // IMPORTANT: In a production app, use the get() method to check against a document.
  let admin_uids = ['dqrHnJtM27bMpNudHxO5hL3wsNE3'];
  return request.auth != null && request.auth.uid in admin_uids;
}

service cloud.firestore {
  match /databases/{database}/documents {

    // Admins have full access to everything.
    match /{document=**} {
      allow read, write: if isAdmin();
    }
    
    // Publicly readable content for all users
    match /courses/{courseId} {
      allow read: if true;
      allow write: if isAdmin(); // Only admins can write
    }
    match /instructors/{instructorId} {
      allow read: if true;
      allow write: if isAdmin(); // Only admins can write
    }
    match /blogPosts/{postId} {
      // Published posts are public
      allow read: if resource.data.status == 'published';
      allow write: if isAdmin(); // Only admins can write
    }
     match /events/{eventId} {
      allow read: if true;
      allow write: if isAdmin(); // Only admins can write
    }

    // Student progress can only be read/written by the owning user OR an admin.
    match /studentProgress/{userId} {
      allow read, write: if (request.auth != null && request.auth.uid == userId) || isAdmin();
    }

    // Feedback can be created by anyone, but only read by admins.
    match /feedback/{feedbackId} {
      allow create: if true;
      allow read, update, delete: if isAdmin();
    }
    
    // Attendees can be created by authenticated users. Admins can read them.
    match /events/{eventId}/attendees/{userId} {
        allow create: if request.auth != null && request.auth.uid == userId;
        allow read, update, delete: if isAdmin();
    }
  }
}
