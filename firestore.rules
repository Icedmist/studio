
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if a user is an administrator.
    // UIDs are hardcoded here as rules cannot access application source code.
    function isAdmin() {
      return request.auth != null && request.auth.uid in ['dqrHnJtM27bMpNudHxO5hL3wsNE3'];
    }

    // Public Collections: Anyone can read, only admins can write.
    match /courses/{courseId} {
      allow get, list: true;
      allow write: if isAdmin();
    }

    match /instructors/{instructorId} {
      allow get, list: true;
      allow write: if isAdmin();
    }
    
    match /blogPosts/{postId} {
      allow get, list: true;
      allow write: if isAdmin();
    }

    match /events/{eventId} {
      allow get, list: true;
      allow write: if isAdmin();
    }

    // Attendees are a subcollection of events.
    // Authenticated users can register (create their own doc).
    // Admins can manage all attendees.
    match /events/{eventId}/attendees/{userId} {
      allow get, list: if request.auth != null;
      allow create: if request.auth.uid == userId;
      allow update, delete: if isAdmin();
    }
    
    // User-Specific Collections: Users can manage their own data.
    match /studentProgress/{userId} {
      allow read, update: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null;
    }
    
    match /feedback/{feedbackId} {
      // Anyone can submit feedback.
      allow create: true;
      // Only admins can read/delete feedback submissions.
      allow read, list, delete: if isAdmin();
    }
  }
}
