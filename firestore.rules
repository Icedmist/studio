
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if a user is an admin
    function isAdmin() {
      // Check if the user's UID is in the list of admin UIDs.
      // Replace with your actual admin UIDs.
      return request.auth.uid in ['dqrHnJtM27bMpNudHxO5hL3wsNE3'];
    }

    // Public collections: Allow anyone to read, but only admins to write.
    match /courses/{docId} {
      allow get, list: if true;
      allow write: if isAdmin();
    }
    match /instructors/{docId} {
      allow get, list: if true;
      allow write: if isAdmin();
    }
    match /events/{docId} {
      allow get, list: if true;
      allow write: if isAdmin();
    }
    match /blogPosts/{docId} {
      allow get, list: if true;
      allow write: if isAdmin();
    }
    
    // Allow admins to read/write any subcollection under events (for attendees)
    match /events/{eventId}/{subcollection}/{docId} {
        allow read, write: if isAdmin();
    }
    // Allow authenticated users to register for events
     match /events/{eventId}/attendees/{userId} {
        allow create: if request.auth.uid == userId;
        allow read: if request.auth.uid == userId || isAdmin();
    }

    // User-specific data: Only the user or an admin can access/modify.
    match /studentProgress/{userId} {
      allow read, write: if request.auth.uid == userId || isAdmin();
    }
    
    // Feedback: Any authenticated user can create feedback. Only admins can manage it.
    match /feedback/{docId} {
        allow create: if request.auth != null;
        allow read, update, delete: if isAdmin();
    }
  }
}
